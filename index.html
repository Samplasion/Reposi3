<!DOCTYPE html>
<html lang="en">
<head>
  <title>Samplasion's Repo</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="depictions/ios7.min.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="text/javascript" src="depictions/ios7.min.js"></script>
</head>
<body>

<header role="banner">
  <h1>Samplasion's Repo</h1>
</header>

<main id="content" role="main">
  <article class="panel panel-default">
    <section class="content">
      <ul>
        <li><h3 class="panel-heading">Samplasion's repo</h3> is my Cydia repository</li>
        <li><a href="cydia://url/https://cydia.saurik.com/api/share#?source=https://samplasion.github.io/cydia/" role="button">Add to Cydia</a></li>
      </ul>
    </section>
  </article>

  <article class="panel panel-default">
    <header><h2>Hosted Packages</h2></header>
  </article>

  <div id="tweakslist">
  </div>
</main>

<script>
function readTextFile(file) {
  return new Promise((res, rej) => {
    var rawFile = new XMLHttpRequest();
    rawFile.open("GET", file, false);
    rawFile.onreadystatechange = function () {
        if(rawFile.readyState === 4) {
            if(rawFile.status === 200 || rawFile.status == 0) {
                var allText = rawFile.responseText;
                res(allText);
            }
        }
    }
    rawFile.send(null);
    setTimeout(() => rej(""), 10000)
  })
}

readTextFile("http://www.samplasion.tk/cydia/Packages").then(text => {

  var packages = text.split("\n\n")

  packages.forEach(package => {
    var metadata = {}
    package.split("\n").forEach(pm => {
      metadata[pm.split(": ")[0]] = pm.split(": ")[1]
    })

    var div = $("<div>")
    div.html(`
      <article class="panel panel-default">
  	  <section class="content"><ul><li><h4 class="panel-heading">${metadata.Name} ${metadata.Version}</h4>
    ${metadata.Description}</li><li>
    <a class="btn btn-xs btn-default" href="depictions/?p=${metadata.Package}" role="button">More info</a></li></ul>
  	  </section>
      </article>
      `)
    div.addClass("panel")
    div.addClass("panel-default")
    $("#tweakslist").append(div)
  })
})
</script>

</body>
</html>
